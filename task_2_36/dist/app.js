function Point(n,e){this.x=n||0,this.y=e||0,this.G=0,this.H=0,this.F=0,this.isHinder=!1,this.isClosed=!1,this.prePoint=null}Point.prototype.setH=function(n){this.H=5*(Math.abs(n.x-this.x)+Math.abs(n.y-this.y))},Point.prototype.setG=function(n){this.G+=n},Point.prototype.setF=function(){this.F=this.G+this.H};var astart=function(){function n(n,e,t){o=n,i=e,a=t}function e(n,e,o){var i=[];for(i.push(n),n.setF(e);0!=i.length;){for(var a=r(i),s=t(a,o),l=0,c=s.length;c>l;l++){var u=s[l];-1!=i.indexOf(u)&&o?-1!=i.indexOf(u)&&o&&a.G+u.G>=a.prePoint.G+a.G&&(a.isClosed=!0,i.splice(i.indexOf(a),1),a=u):(u.setH(e),u.setG(a.G),u.setF(),i.push(u),u.prePoint=a)}if(i.splice(i.indexOf(a),1),a.isClosed=!0,1==e.isClosed){for(var f=[],d=e;null!=d;)f.push(d),d=d.prePoint;return f.reverse()}}return[]}function t(n,e){function t(n,e){return o[e*i+n]}var r,s=n.x,l=n.y,c=s-1,u=s+1,f=l-1,d=l+1,h=[];return c>-1&&(r=t(c,l),r.G=1,r.isHinder||r.isClosed||h.push(r)),i>u&&(r=t(u,l),r.G=1,r.isHinder||r.isClosed||h.push(r)),f>-1&&(r=t(s,f),r.G=1,r.isHinder||r.isClosed||h.push(r)),a>d&&(r=t(s,d),r.G=1,r.isHinder||r.isClosed||h.push(r)),e&&(c>-1&&f>-1&&(console.log("left up"),r=t(c,f),r.G=1.5,r.isClosed||r.isHinder||h.push(r)),i>u&&f>-1&&(console.log("right up"),r=t(u,f),r.G=1.5,r.isClosed||r.isHinder||h.push(r)),a>d&&c>-1&&(console.log("left down"),r=t(c,d),r.G=1.5,r.isClosed||r.isHinder||h.push(r)),a>d&&i>u&&(console.log("right down"),r=t(u,d),r.G=1.5,r.isClosed||r.isHinder||h.push(r))),h}function r(n){for(var e=Number.MAX_VALUE,t=0,r=0,o=n.length;o>r;r++)n[r].F<e&&(e=n[r].F,t=r);return n[t]}var o=[],i=0,a=0;return{findPath:e,setMap:n}}(),analysis=function(){function n(n){for(var t=[],r=void 0,o=n.split(/\n|\r/),i=null,a=0,s=o.length;s>a;a++){if(i=e(o[a]),i===!1){r=a,editor.addWrong(r);break}t.push(i)}return r?[]:t}function e(n){var e=n.split(/\s+/);return void 0!==c[e[0]]?c[e[0]].apply(null,e.slice(1)):!1}function t(n){var e=null;return void 0!=n?(n=n.trim(),null!=n.match(/^[0-9]*$/)&&(e=parseInt(n))):e=1,e}function r(n){if(arguments.length>1)return!1;void 0!==n&&0==n.length&&(n=void 0);var e=t(n);return e?["go",e]:e}function o(n){return arguments.length>1&&arguments[1].length>0?!1:void 0!=n&&n.match(/^LEF$|^RIG$|^BAC$/)?["tun",n]:!1}function i(n,e){if(arguments.length>2)return!1;if(void 0==n||!n.match(/^LEF$|^RIG$|^TOP$|^BOT$/))return!1;void 0!==e&&0==e.length&&(e=void 0);var r=t(e);return r?["tra",n,r]:!1}function a(n,e){if(arguments.length>2)return!1;if(n.match(/^TO$/)){var r=e;if(void 0!=r){var o=r.split(",");return null!=t(o[0])&&null!=t(o[1])?["moveTo",parseInt(o[0]),parseInt(o[1])]:!1}}if(void 0==n||!n.match(/^LEF$|^RIG$|^TOP$|^BOT$/))return!1;void 0!=e&&0==e.length&&(e=void 0);var i=t(e);return i?["mov",n,i]:!1}function s(){return arguments.length>0&&0!=arguments[0].length?!1:["build"]}function l(n){return arguments.length>1&&0!=arguments[1].length?!1:(n=n.toLowerCase(),n.match(/^#[0-9a-f]{3}$|^#[0-9a-f]{6}$/)?["bru",n]:!1)}var c={GO:r,TUN:o,TRA:i,MOV:a,BUILD:s,BRU:l};return{analyze:n}}(),Map=function(){function n(){function n(n,t){e(n,t).isHinder=!0}function e(n,e){return a[n+e*i]}function t(n,t,o,l,c){r(!1);var u=e(n,t),f=e(o,l);return astart.setMap(a,i,s),astart.findPath(u,f,!1)}function r(n){for(var e=0,t=i*s;t>e;e++){var r=a[e];r.isClosed=!1,r.G=0,r.H=0,r.F=0,r.prePoint=null,n&&(r.isHinder=!1)}}function o(n,e){i=n,s=e;for(var t,r=0,o=n*e;o>r;r++)t=new Point(r%i,Math.floor(r/i)),a.push(t)}var i,a=[],s=0;return{initMap:o,addHinder:n,search:t,refresh:r}}var e;return{getInstance:function(){return e||(e=n()),e}}}(),Wall=function(){function n(n,e){Map.getInstance().addHinder(n,e)}function e(){for(var n=99;n--;)i[n].classList.contains("wall")&&i[n].classList.remove("wall"),i[n].backgroundColor="#999";Map.getInstance().refresh(!0)}function t(n,e){i[10*e+n].classList.add("wall")}function r(n,e){var r=Math.floor(5*Math.random()+1);console.log(r);for(var o=0;r>o;o++){var i=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());n!==i&&e!==a&&t(i,a)}}function o(n,e,t){var r=i[e*a+n];r.classList.contains("wall")&&(r.style.backgroundColor=t)}var i=document.querySelectorAll(".grid-map .grid"),a=10;return{addWall:t,randomWall:r,brushWall:o,refresh:e,setHinder:n}}(),hero=function(){function n(){return[g[4],g[5]]}function e(){g=[1,0,0,1,200,200],v=0,p=[],L=!1,T.style.transform="matrix("+g.join(",")+")"}function t(n){T=n,T.addEventListener("transitionend",function(){var n;if(0!=p.length){for(n=p.shift();"[object Function]"===Object.prototype.toString.call(n);)n(),n=p.shift();void 0!=n&&(T.style.transform=n,L=!1)}else L=!1})}function r(n){for(var e=0,t=n.length;t>e;e++)m[n[e][0]].apply(null,n[e].slice(1));if(0!=p.length&&0==L){for(var r=p.shift();"[object Function]"===Object.prototype.toString.call(r);)r(),r=p.shift();T.style.transform=r,L=!0}}function o(n){u(v,n)}function i(n){switch(console.log(n),n){case"LEF":v=--v>-1?v:v+=4;break;case"RIG":v=++v<4?v:v-=4;break;case"BAC":v=(v+=2)<4?v:v-=4}f(v)}function a(n,e){switch(n){case"LEF":n=3;break;case"RIG":n=1;break;case"TOP":n=0;break;case"BOT":n=2}u(n,e)}function s(n,e){switch(n){case"LEF":v=3;break;case"RIG":v=1;break;case"TOP":v=0;break;case"BOT":v=2}f(v),o(e)}function l(n,e){console.log("search"),n--,e--;var t=Map.getInstance().search(Math.floor(g[4]/50),Math.floor(g[5]/50),n,e);c(t)}function c(n){var e,t,r,o,i=!1,a=!1;if(0!=n.length){e=r=n[0].x,t=o=n[0].y;for(var s=1,l=n.length;l>s;s++){var c,d=n[s];d.y==o&&(0==a?i=!0:(c=o-t>0?2:0,f(c),u(c,Math.abs(o-t)),t=o,a=!1,i=!0)),d.x==r&&(0==i?a=!0:(c=r-e>0?1:3,f(c),u(c,Math.abs(r-e)),e=r,i=!1,a=!0)),r=d.x,o=d.y}i&&(c=r-e>0?1:3,f(c),u(c,Math.abs(r-e))),a&&(c=o-t>0?2:0,f(c),u(c,Math.abs(o-t)))}}function u(n,e){var t=50*e,r=!1;switch(n){case 0:g[5]-=t,g[5]<0&&(r=!0,g[5]=0);break;case 1:g[4]+=t,g[4]>450&&(g[4]=450,r=!0);break;case 2:g[5]+=t,g[5]>450&&(g[5]=450,r=!0);break;case 3:g[4]-=t,g[4]<0&&(r=!0,g[4]=0)}if(1!=r){var o="matrix("+g.join(",")+")";p.push(o)}}function f(n){switch(v=n,n){case 0:g[0]=1,g[1]=0,g[2]=0,g[3]=1;break;case 1:g[0]=0,g[1]=1,g[2]=-1,g[3]=0;break;case 2:g[0]=-1,g[1]=0,g[2]=0,g[3]=-1;break;case 3:g[0]=0,g[1]=-1,g[2]=1,g[3]=0}var e="matrix("+g.join(",")+")";p.push(e)}function d(n){var e=g[4]/50,t=g[5]/50;switch(v){case 0:t--;break;case 1:e++;break;case 2:t++;break;case 3:e--}if(e>=0&&t>=0&&9>=e&&9>=t){var r=function(){console.log(e,t,n),Wall.brushWall(e,t,n)};p.push(r)}}function h(){var n=g[4]/50,e=g[5]/50;switch(v){case 0:e--;break;case 1:n++;break;case 2:e++;break;case 3:n--}if(n>=0&&e>=0&&9>=n&&9>=e){Wall.setHinder(n,e);var t=function(){Wall.addWall(n,e)};p.push(t)}}var v=0,p=[],T=null,g=[1,0,0,1,200,200],L=!1,m={go:o,tun:i,tra:a,mov:s,moveTo:l,bru:d,build:h};return{getPosition:n,init:t,receiveActions:r,refresh:e}}(),editor=function(){function n(){if(a){var n=document.querySelectorAll(".line");n[a].classList.remove("error"),a=null}}function e(){i.value="";for(var n=1;n!==r;)o.removeChild(o.lastElementChild),r--}function t(n){var e=document.querySelectorAll(".line");e[n].classList.add("error"),a=n}var r=1,o=document.querySelector(".lineCount"),i=document.querySelector("#textarea"),a=null;return i.addEventListener("keyup",function(){n();for(var e=i.value.split(/\r*\n/).length,t=document.createDocumentFragment();e!==r;)if(r>e)o.removeChild(o.lastElementChild),r--;else{var a=document.createElement("div");a.classList.add("line"),a.innerHTML=++r,t.appendChild(a)}o.appendChild(t)}),i.addEventListener("scroll",function(n){var e=i.scrollTop;console.log(e),o.style.top=-e+"px"}),{addWrong:t,refresh:e}}(),go=document.querySelector(".go"),refresh=document.querySelector(".refresh"),random=document.querySelector(".random"),draw=document.querySelector(".draw"),text=document.querySelector("textarea"),grid=document.querySelector(".hero");hero.init(grid),Map.getInstance().initMap(10,10),go.addEventListener("click",function(){var n=analysis.analyze(text.value);hero.receiveActions(n)}),random.addEventListener("click",function(){var n=hero.getPosition();Wall.randomWall(n[0],n[1])}),refresh.addEventListener("click",function(){editor.refresh(),Wall.refresh(),hero.refresh()}),draw.addEventListener("click",function(){text.value="MOV TO 3,7\nTUN RIG\nBUILD\nTRA TOP\nBUILD\nTRA TOP\nBUILD\nTRA TOP\nBUILD\nTUN LEF\nBUILD\nTRA RIG\nBUILD\nMOV TO 3,3\nTUN LEF\nBUILD\nTRA BOT\nTUN RIG\nBUILD\nTRA RIG\nBUILD\nMOV TO 8,7\nTUN RIG\nBUILD\nTRA TOP\nBUILD\nTRA TOP\nBUILD\nTRA TOP\nBUILD\nTRA TOP\nBUILD\nMOV TO 8,6\nBUILD\nTRA RIG\nBUILD\nTUN BAC\nBUILD\nTRA LEF\nBUILD\nMOV TO 9,4\nTUN RIG\nBUILD\nTRA LEF\nBUILD\nMOV TO 5,5\nTUN BAC\nMOV BOT 5\nTRA LEF 4\nTUN BAC\nBUILD\nBRU #383838\nTRA RIG\nBUILD\nBRU #383838\nTRA LEF\nTUN RIG\nBUILD\nBRU #383838\nTUN LEF";var n=analysis.analyze(text.value);hero.receiveActions(n)});